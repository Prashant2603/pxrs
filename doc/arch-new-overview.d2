title: |md
  # New Architecture: Producer → Orchestrator Cluster → xRS Consumers → Shared DB
|

direction: down

producer: Producer {
  shape: rectangle
}

orchestrator: Orchestrator Cluster (Raft) {
  leader: Leader {
    shape: rectangle
  }
  f1: Follower 1 {
    shape: rectangle
  }
  f2: Follower 2 {
    shape: rectangle
  }

  leader -> f1: Raft log replication
  leader -> f2: Raft log replication
  f1 -> leader: elect on leader failure
  f2 -> leader: elect on leader failure
}

xrs: xRS Consumers {
  xrs1: xRS-1 {
    shape: rectangle
  }
  xrs2: xRS-2 {
    shape: rectangle
  }
  xrs3: xRS-3 {
    shape: rectangle
  }
}

db: Consumer DB {
  shape: cylinder
}

producer -> xrs.xrs1: partition stream (p0, p1, p2)
producer -> xrs.xrs2: partition stream (p3, p4, p5)
producer -> xrs.xrs3: partition stream (p6, p7)

orchestrator.leader -> xrs.xrs1: ASSIGN / REVOKE
orchestrator.leader -> xrs.xrs2: ASSIGN / REVOKE
orchestrator.leader -> xrs.xrs3: ASSIGN / REVOKE

xrs.xrs1 -> orchestrator.leader: REGISTER / HEARTBEAT
xrs.xrs2 -> orchestrator.leader: REGISTER / HEARTBEAT
xrs.xrs3 -> orchestrator.leader: REGISTER / HEARTBEAT

xrs.xrs1 -> db: read checkpoint on ASSIGN\nwrite checkpoint + data per message
xrs.xrs2 -> db: read checkpoint on ASSIGN\nwrite checkpoint + data per message
xrs.xrs3 -> db: read checkpoint on ASSIGN\nwrite checkpoint + data per message
